# üîπ –û–ø–∏—Å–∞–Ω–∏–µ

–†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Ü–∏–∫–ª–∞ —Å–æ–±—ã—Ç–∏–π –Ω–∞ –æ—Å–Ω–æ–≤–µ –≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä–æ–≤ (event-loop) –∫–æ–¥ –î—ç–≤–∏–¥–∞ –ë–∏–∑–ª–∏.
–ö–æ–¥ —è–≤–ª—è–µ—Ç—Å—è –º–æ–¥–∏—Ñ–∏–∫–∞—Ü–∏–µ–π –∫–æ–¥–∞ –î—ç–≤–∏–¥–∞ –ë–∏–∑–ª–∏ & –Ø–Ω–¥–µ–∫—Å –ü—Ä–∞–∫—Ç–∏–∫—É–º–∞. 

1. **`Task`** ‚Äì –ø—Ä–µ–¥—Å—Ç–∞–≤–ª—è–µ—Ç —Å–æ–±–æ–π –∑–∞–¥–∞—á—É, –æ–±–æ—Ä–∞—á–∏–≤–∞–µ—Ç –∫–æ—Ä—É—Ç–∏–Ω—É (—Ñ—É–Ω–∫—Ü–∏—é-–≥–µ–Ω–µ—Ä–∞—Ç–æ—Ä) –∏ —É–ø—Ä–∞–≤–ª—è–µ—Ç –µ—ë –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º.
2. **`Scheduler`** ‚Äì –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ –∑–∞–¥–∞—á, —É–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ–º –∏ –æ–±—Ä–∞–±–æ—Ç–∫–æ–π —Å–æ–±—ã—Ç–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞.
3. **`AsyncSocket`** ‚Äì –æ–±–µ—Ä—Ç–∫–∞ –Ω–∞–¥ `socket`, –ø–æ–∑–≤–æ–ª—è—é—â–∞—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –µ–≥–æ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ.
4. **`SystemCall`** ‚Äì –±–∞–∑–æ–≤—ã–π –∫–ª–∞—Å—Å –¥–ª—è —Å–∏—Å—Ç–µ–º–Ω—ã—Ö –≤—ã–∑–æ–≤–æ–≤ (–Ω–∞–ø—Ä–∏–º–µ—Ä, `NewTask`, `WriteWait`, `ReadWait`).
5. **`NewTask`** ‚Äì —Å–æ–∑–¥–∞—ë—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É –≤ –ø–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫–µ.
6. **`WriteWait` / `ReadWait`** ‚Äì –ø–æ–∑–≤–æ–ª—è—é—Ç –ø—Ä–∏–æ—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –∑–∞–¥–∞—á–∏ –¥–æ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ —Å–æ–∫–µ—Ç–∞ –∫ –∑–∞–ø–∏—Å–∏/—á—Ç–µ–Ω–∏—é.

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç event loop

1. **–ó–∞–ø—É—Å–∫ —Å–µ—Ä–≤–µ—Ä–∞ (`server`)**
	- –ó–∞–ø—É—Å–∫–∞–µ—Ç `socket` –∏ –æ–∂–∏–¥–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤.
    - –ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞ —Å–æ–∑–¥–∞–µ—Ç –Ω–æ–≤—É—é –∑–∞–¥–∞—á—É `handle_client(client, address)`.
2. **–û–±—Ä–∞–±–æ—Ç–∫–∞ –∫–ª–∏–µ–Ω—Ç–∞ (`handle_client`)**
    - –ß–∏—Ç–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ —Å–æ–∫–µ—Ç–∞ (`recv`).
    - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å, –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –∏—Ö –æ–±—Ä–∞—Ç–Ω–æ (`send`).
    - –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç ‚Äì –∑–∞–∫—Ä—ã–≤–∞–µ—Ç —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.
3. **–ü–ª–∞–Ω–∏—Ä–æ–≤—â–∏–∫ (`Scheduler`)**
	- –£–º–µ–µ—Ç:
	- –î–æ–±–∞–≤–ª—è—Ç—å –∑–∞–¥–∞—á–∏ (`add_task`).
	- –û–∂–∏–¥–∞—Ç—å —Å–æ–±—ã—Ç–∏–π –≤–≤–æ–¥–∞-–≤—ã–≤–æ–¥–∞ (`wait_for_read`, `wait_for_write`).
	- –í—ã–ø–æ–ª–Ω—è—Ç—å –∑–∞–¥–∞—á–∏ (`_run_once`).
	- –†–∞–±–æ—Ç–∞—Ç—å —Å `selectors` (—Å–ª–µ–¥–∏—Ç—å –∑–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å—é —Å–æ–∫–µ—Ç–æ–≤).
    - –ó–∞–ø—É—Å–∫–∞–µ—Ç –±–µ—Å–∫–æ–Ω–µ—á–Ω—ã–π —Ü–∏–∫–ª –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∑–∞–¥–∞—á (`event_loop`).


## –ò—Ç–æ–≥: –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç?

1. **–ó–∞–ø—É—Å–∫–∞–µ—Ç—Å—è `event_loop()`** ‚Üí –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä `server()`.
2. **–°–µ—Ä–≤–µ—Ä —Å–ª—É—à–∞–µ—Ç —Å–æ–∫–µ—Ç** –∏ –∂–¥–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫–ª–∏–µ–Ω—Ç–æ–≤ (`accept`).
3. **–ü—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏** —Å–æ–∑–¥–∞–µ—Ç—Å—è `handle_client()`.
4. **–ß–∏—Ç–∞–µ–º –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –¥–∞–Ω–Ω—ã–µ –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ** (`recv` / `send`).
5. **–ï—Å–ª–∏ –¥–∞–Ω–Ω—ã—Ö –Ω–µ—Ç** ‚Üí –∑–∞–∫—Ä—ã–≤–∞–µ–º —Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ.